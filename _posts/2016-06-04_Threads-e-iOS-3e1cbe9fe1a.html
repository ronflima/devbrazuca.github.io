<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Threads e iOS</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Threads e iOS</h1>
</header>
<section data-field="subtitle" class="p-summary">
A importância de conhecer o sistema no qual você programa.
</section>
<section data-field="body" class="e-content">
<section name="bcf3" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f131" id="f131" class="graf graf--h3 graf--leading graf--title">Threads e iOS</h3><h4 name="9c43" id="9c43" class="graf graf--h4 graf-after--h3 graf--subtitle">A importância de conhecer o sistema no qual você programa.</h4><figure name="8a23" id="8a23" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*XQN6E3sj3JkB-6ORRSV9-A.jpeg" data-width="1280" data-height="960" src="https://cdn-images-1.medium.com/max/800/1*XQN6E3sj3JkB-6ORRSV9-A.jpeg"></figure><p name="40a7" id="40a7" class="graf graf--p graf-after--figure">Programar em ambientes multi-threaded não é uma tarefa fácil. As threads adicionam elementos de incerteza no seu código que podem levar a problemas muito difíceis de serem reproduzidos <em class="markup--em markup--p-em">in vitro</em>, ou a problemas intermitentes. Porém, se você programa para iOS, não importa se em Objective C ou em Swift, as threads vão bater na sua porta, cedo ou tarde.</p><p name="6385" id="6385" class="graf graf--p graf-after--p">No dia-a-dia você usa somente uma thread: a <em class="markup--em markup--p-em">main thread</em>. Nela você responde a eventos, desenha a tela, carrega tabelas, e por aí vai. Se você precisa realizar algum processamento mais custoso usando a main thread você dá de presente ao seu usuário uma tela que não responde aos seus comandos e a sua aplicação fica com aquela cara enfadonha de &quot;travei&quot;.</p><p name="65f7" id="65f7" class="graf graf--p graf-after--p">É importante conhecer a estrutura do sistema operacional que você usa para que possa tirar proveito dessa estrutura. As threads são caras e complexas. Você pode criá-las ou usar a infra-estrutura do Cocoa para isso através do Grand Central Dispatch ou das Operation Queues.</p><h4 name="c53e" id="c53e" class="graf graf--h4 graf-after--p">Grand Central Dispatch</h4><p name="896b" id="896b" class="graf graf--p graf-after--h4">O Grand Central Dispatch apareceu no Mac OS X 10.6. Trata-se de uma infra-estrutura que permite a programação concorrente sem que você precise preocupar-se com os detalhes das threads. Como o iOS veio do Mac OS X, inclusive usando o mesmo kernel Darwin, o GCD apareceu neste ambiente também.</p><p name="edb2" id="edb2" class="graf graf--p graf-after--p">O GCD foi criado para dar suporte a programas escritos em C. Isto fica evidente na forma como funciona: funções trabalhando em cima de estruturas de dados opacas. Muita gente usa o GCD em programas escritos em Objective C, talvez por desconhecerem as Operation Queues.</p><p name="8fe0" id="8fe0" class="graf graf--p graf-after--p">Porém, o GCD é muito mais simples de usar do que as POSIX Threads, que exigem um trabalho mais pesado de gerenciamento de recursos. É possível usar o GCD tanto do Objective C quanto do Swift.</p><h4 name="99c7" id="99c7" class="graf graf--h4 graf-after--p">Operation Queues</h4><p name="80c9" id="80c9" class="graf graf--p graf-after--h4">As operation queues são construídas por sobre o GCD e oferecem uma interface orientada ao objeto para as dispatch queues. A Apple, inclusive, sugere que sejam usadas em lugar das dispatch queues justamente por oferecerem mais suporte à linguagem Objective C e Swift. Por exemplo, você pode criar uma NSBlockOperation, ou seja, uma operação baseada em blocos para que você não precise criar uma subclasse de uma NSOperation para executar uma tarefa em background.</p><p name="bb2b" id="bb2b" class="graf graf--p graf-after--p">Apesar de vários exemplos da Apple usarem as dispatch queues, eu sempre dou preferência às operation queues pelas facilidades de integração com o Objective C e com o Swift.</p><h4 name="a533" id="a533" class="graf graf--h4 graf-after--p">Por que threads?</h4><p name="d4c4" id="d4c4" class="graf graf--p graf-after--h4">O objetivo do seu app é manter-se respondendo ao usuário. Executar tarefas longas na main thread tira esta capacidade de resposta, pois o sistema passará muito tempo executando seu código ao invés de responder de forma hábil ao usuário.</p><p name="f678" id="f678" class="graf graf--p graf-after--p">Porém, as threads têm um preço. As threads adicionam problemas relacionados ao tempo no seu software, criam problemas com invariantes e podem levar a defeitos muito difíceis de serem reproduzidos em laboratório. Além disso, você precisa projetar seu software para trabalhar de forma assíncrona, distribuindo o processamento e tomando o cuidado de evitar a quebra e corrupção de dados por acessos simultâneos.</p><p name="6f20" id="6f20" class="graf graf--p graf-after--p">Programar em threads não é, definitivamente, algo simples. Muita gente super simplifica isso criando inúmeros pontos de sincronismo e, efetivamente, criando código síncrono complexo ao invés de deixar o &quot;bicho solto&quot;. Se você escreve código abarrotado de pontos de sincronismo é por que você não precisa de threads realmente.</p><p name="7305" id="7305" class="graf graf--p graf-after--p">A criação de uma thread, também, não é gratuita. Ela consome recursos do sistema, como processador e memória. Em um ambiente restrito, como um iDevice, estes são recursos caros. Portanto, ao criar um ambiente baseado em threads, é importante ter certeza absoluta que isto será necessário para justificar o consumo de recursos.</p><h4 name="239b" id="239b" class="graf graf--h4 graf-after--p">Aprenda os conceitos!</h4><p name="d756" id="d756" class="graf graf--p graf-after--h4">Existe muita literatura sobre o assunto. Não saia simplesmente programando em threads só por que conhece o SDK. Saiba exatamente o que está fazendo. Saiba quais são os seus invariantes, quais trechos de código são seções críticas e como lidar com elas.</p><p name="a41c" id="a41c" class="graf graf--p graf-after--p">É importante conhecer os métodos de sincronismo, como os mutexes, as barreiras, as condition variables. Cada coisa dessas tem uma função diferente e serve para um determinado cenário que depende do design que você fizer do seu código.</p><p name="8e61" id="8e61" class="graf graf--p graf-after--p graf--trailing">A minha sugestão: leia o livro <a href="https://www.amazon.com.br/Programming-POSIX-Threads-David-Butenhof-ebook/dp/B006QTHCJ6/ref=sr_1_1?ie=UTF8&amp;qid=1465048349&amp;sr=8-1&amp;keywords=posix+threads" data-href="https://www.amazon.com.br/Programming-POSIX-Threads-David-Butenhof-ebook/dp/B006QTHCJ6/ref=sr_1_1?ie=UTF8&amp;qid=1465048349&amp;sr=8-1&amp;keywords=posix+threads" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Programming with POSIX Threads</a>, de David Butenhof. É um livro antigo, mas excelente e ainda atual. O importante do livro não são as threads POSIX em si, mas os conceitos que envolvem as mesmas.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@ronaldolima" class="p-author h-card">Ronaldo Faria Lima</a> on <a href="https://medium.com/p/3e1cbe9fe1a"><time class="dt-published" datetime="2016-06-04T13:54:20.274Z">June 4, 2016</time></a>.</p><p><a href="https://medium.com/@ronaldolima/threads-e-ios-3e1cbe9fe1a" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 25, 2020.</p></footer></article></body></html>